<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trung Thu</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Mali:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --accent: #ff7f50;
      --accent-2: #ff5722;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: "Mali", cursive;
      background: #060614;
      overflow: hidden;
    }

    .stage {
      position: relative;
      min-height: 100vh;
      overflow: hidden;
    }

    canvas#starfield {
      display: block;
      width: 100%;
      height: 100%;
    }

    .moon {
      position: absolute;
      top: 60px;
      right: 100px;
      width: 160px;
      height: 160px;
      background: radial-gradient(circle at 30% 30%, #fff, #f8f8f8 70%, #e0e0e0 100%);
      border-radius: 50%;
      box-shadow:
        0 0 50px #ffffff7a,
        0 0 80px rgba(255, 255, 255, 0.7),
        0 0 100ox rgba(255, 255, 255, 0.4);
      filter: drop-shadow(0 0 25px rgba(255, 255, 200, 0.8));
      animation: moonGlow 6s ease-in-out infinite;
      z-index: 10;
    }

    @media (max-width:600px) {
      .moon {
        top: 40px;
        right: 14px;
        width: 70px;
        height: 70px;
      }
    }

    #lantern-container {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 10;
    }

    .lantern {
      position: absolute;
      pointer-events: auto;
      width: 40px;
      user-select: none;
    }

    @keyframes swing {
      0% {
        transform: rotate(-5deg);
      }

      50% {
        transform: rotate(5deg);
      }

      100% {
        transform: rotate(-5deg);
      }
    }

    .swing {
      animation: swing 2s ease-in-out infinite;
    }

    #hint {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0);
      color: #ffa722;
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 28px;
      font-weight: 800;
      opacity: 0;
      transition: opacity 0.5s;
      z-index: 1000;
      pointer-events: none;
      text-align: center;
      white-space: nowrap;
      text-shadow:
        0 0 15px #ff8a50,
        0 0 20px #ffd180;
    }

    @media (max-width: 600px) {
      #hint {
        font-size: 22px;
        padding: 8px 12px;
      }
    }

    #wish-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.96);
      color: #ff8d22;
      padding: 35px 40px;
      border-radius: 12px;
      font-size: 1.8rem;
      font-weight: 700;
      display: none;
      z-index: 9999;
      box-shadow: 0 6px 30px rgba(0, 0, 0, 0.35);
      text-align: center;
      max-width: 60%;
      width: auto;
      box-sizing: border-box;
      pointer-events: auto;
      text-shadow: 0 0 25px #ffd180;
      box-shadow:
        0 0 20px #ff8a50,
        0 0 25px #ffd180;
    }

    @media (max-width: 600px) {
      #wish-popup {
        font-size: 1.2rem;
        padding: 20px 25px;
        max-width: 80%;
        width: 80%;
      }
    }

    /* Hiệu ứng cho chữ và ảnh */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes zoomIn {
      from {
        opacity: 0;
        transform: scale(0.5);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .wish-text {
      opacity: 0;
      animation: fadeIn 0.8s forwards;
    }

    .wish-img {
      opacity: 0;
      animation: zoomIn 0.8s forwards;
      animation-delay: 0.8s;
    }
  </style>
</head>

<body>
  <div class="stage">
    <canvas id="starfield"></canvas>
    <div class="moon" aria-hidden="true"></div>
    <div id="lantern-container"></div>
    <div id="wish-popup" role="dialog" aria-live="polite"></div>
    <div id="hint">Chạm vào đèn trời</div>

    <!-- Nhạc nền -->
    <audio id="bg-music" loop>
      <source src="a.mp3" type="audio/mp3">
      Trình duyệt của bạn không hỗ trợ thẻ audio.
    </audio>
  </div>

  <script>
    // ===== Canvas sao =====
    const canvas = document.getElementById("starfield");
    const ctx = canvas.getContext("2d");
    let w, h, stars = [], meteors = [];

    function resizeCanvas() {
      w = canvas.width = innerWidth;
      h = canvas.height = innerHeight;
      stars = [];
      const count = Math.round((w * h) / 2200);
      for (let i = 0; i < count; i++) {
        stars.push({
          x: Math.random() * w,
          y: Math.random() * h,
          r: Math.random() * 0.9 + 0.1,
          a: Math.random() * 0.8 + 0.2,
          t: Math.random() * 0.02 + 0.002
        });
      }
    }

    function drawStars() {
      ctx.clearRect(0, 0, w, h);
      for (const s of stars) {
        s.a += (Math.random() > 0.5 ? 1 : -1) * s.t;
        s.a = Math.max(0.05, Math.min(1, s.a));
        ctx.beginPath();
        ctx.globalAlpha = s.a;
        ctx.fillStyle = "#fff";
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;
    }

    function loop() {
      drawStars();
      requestAnimationFrame(loop);
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
    loop();

    // ===== Đèn lồng + popup =====
    const lanternContainer = document.getElementById("lantern-container");
    const wishes = [
      "Chúc dợ ngta Trung Thu ấm áp, hạnh phúc!",
      "Chúc cổ ngày tết trung thu ấm áp, dui dẻ!",
      "Mùa trăng an lành và ngọt ngào!",
      "Chúc cổ luôn sáng như trăng rằm!",
      "Chúc cổ lúc nào cũng tươi như ánh trăng đêm rằm!",
      "Trăng sáng, lòng an yên!",
      "Mong cổ trung thu nào cũng được bên người thương!",
      "Mọi mong ước thành hiện thực nhé!"
    ];
    const images = [
      "IMG_2474.png",
      "IMG_2478.png",
      "IMG_2532.png",
      "IMG_2570.png",
      "IMG_2609.png",
      "IMG_2460.png",
      "IMG_2439.png",
      "IMG_2605.png",
      "IMG_2576.png",
      "IMG_2545.png",
      "IMG_2603.png",
    ];

    function createLantern() {
      const lantern = document.createElement("img");
      lantern.src = "./den.png";
      lantern.className = "lantern swing";

      let size = 40, duration = 10000, opacity = 0.9;
      size = 30 + Math.random() * 40;
      duration = 12000 + Math.random() * 4000;
      opacity = 0.7 + Math.random() * 0.3;

      lantern.style.width = size + "px";
      lantern.style.left = Math.random() * 90 + "vw";
      lantern.style.bottom = "0px";
      lantern.style.opacity = opacity;

      lanternContainer.appendChild(lantern);

      const drift = Math.random() * 140 - 70;
      const up = 120 + Math.random() * 40;
      lantern.animate(
        [
          { transform: "translate(0,0)", opacity: opacity },
          { transform: `translate(${drift}px, -${up}vh)`, opacity: 0 }
        ],
        { duration: duration, easing: "linear", fill: "forwards" }
      );

      setTimeout(() => lantern.remove(), duration);

      lantern.addEventListener("click", (e) => {
        e.stopPropagation();
        const wishPopup = document.getElementById("wish-popup");

        const randomWish = wishes[Math.floor(Math.random() * wishes.length)];
        const randomImage = images[Math.floor(Math.random() * images.length)];

        wishPopup.innerHTML = `
          <div class="wish-text">${randomWish}</div>
          <img src="${randomImage}" alt="Hình Trung Thu" 
               class="wish-img" style="max-width:200px; border-radius:10px; margin-top:15px;" />
        `;
        wishPopup.style.display = "block";
      });
    }

    setInterval(createLantern, 500);

    // ===== Nhạc nền =====
    const bg = document.getElementById("bg-music");
    let musicStarted = false;
    document.addEventListener("pointerdown", function startMusicOnce() {
      if (!musicStarted && bg) {
        bg.volume = 0;
        bg.play().then(() => {
          let v = 0;
          const fadeIn = setInterval(() => {
            v += 0.05;
            if (v >= 0.9) {
              v = 0.9;
              clearInterval(fadeIn);
            }
            bg.volume = v;
          }, 120);
          musicStarted = true;
        }).catch(() => { });
      }
      document.removeEventListener("pointerdown", startMusicOnce);
    });

    // ===== Ẩn popup khi click ngoài =====
    document.addEventListener("click", (e) => {
      const pop = document.getElementById("wish-popup");
      if (pop && pop.style.display === "block") {
        pop.style.display = "none";
      }
    });

    // ===== Hint =====
    const hint = document.getElementById("hint");
    setTimeout(() => {
      if (hint) {
        hint.style.opacity = "1";
      }
      setTimeout(() => {
        if (hint) {
          hint.style.opacity = "0";
        }
      }, 5000);
    }, 1000);
  </script>
</body>

</html>
